@using Corno.Data.Corno.Question_Bank.Dtos
@using Corno.OnlineExam.Helpers
@using Kendo.Mvc.UI
@model Corno.Data.Corno.Question_Bank.Models.Question


<div id="indexForm" class="form-horizontal box-content">
    <div class="k-card k-card-vertical">
        <div class="k-card-header k-card-tertiary">
            <div class="row">
                <div class="col-sm-10">
                    <h3>Questions</h3>
                </div>
                @*<div class="k-card-actions k-card-actions-horizontal k-card-actions-end col-sm-2">
                    @(Html.Kendo().Button()
                        .Name("New")
                        .Icon("plus")
                        .SpriteCssClass("k-icon-64")
                        .FillMode(ButtonFillMode.Outline)
                        .ThemeColor(ThemeColor.Info)
                        .Content("Add New")
                        //.Events(e => e.Click("window.location.href = '/Question/Create'"))
                        .Events(e => e.Click("onCreate"))
                        .HtmlAttributes(new{@class = "w-100"}))
                </div>*@
            </div>
        </div>
        <div class="k-card-body">
            <div class="form-group row">
                <div style="overflow-x: auto;">
                    @(Html.Kendo().Grid<QuestionIndexDto>()
                             .Name("gridIndex")
                             //.ApplyCommonSettings() // 👈 Apply shared settings
                             .HtmlAttributes(new { style = "width: auto;text-align:center" })
                            .ToolBar(toolbar =>
                            {
                                toolbar.Search();
                            })
                            .Scrollable(scroll => scroll.Virtual(true))
                            .Pageable(pageable => pageable
                                .ButtonCount(5)
                                .PageSizes(new[] { 5, 10, 20, 50, 100, 500, 1000 }))
                            .Filterable(f => f.Mode(GridFilterMode.Row))
                            .Resizable(resize => resize.Columns(true))
                            .PersistSelection()
                            .Reorderable(r => r.Columns(true))
                            .ColumnMenu(s => s.Sortable(true))
                            .Height(540)
                             .Events(events => events.ApplyCommonEvents())
                             .Columns(columns =>
                             {
                                 columns.Bound(m => m.SerialNo)
                                     .Title("Sr. \nNo.")
                                     //.Width(80)
                                     .Filterable(false)
                                     .Sortable(false)
                                     .ColumnMenu(false)
                                     .HtmlAttributes(new { @class = "k-text-center" })
                                     .HeaderHtmlAttributes(new { @class = "k-text-center" });
                                 columns.AddCommandColumns(new List<GridCommandConfig>
                                 {
                                     new GridCommandConfig { Name = "Edit", Text = "", IconClass = "fa fa-edit", ClickHandler = "onEditClick" },
                                 });
                                 columns.Bound(m => m.PaperCategoryName)
                                     .Align(TextAlign.Left).Title("Paper");
                                 columns.Bound(m => m.SubjectName).Align(TextAlign.Left)
                                     .Title("Subject");
                                 columns.Bound(m => m.CourseName).Align(TextAlign.Left)
                                     .Title("Course");
                                 columns.Bound(m => m.FacultyName).Align(TextAlign.Left)
                                     .Title("Faculty");
                             })
                             .DataSource(dataSource => dataSource
                                 .ApplyCommonDataSourceSettings("GetIndexDtos", "Question", "Question Bank")
                        ))
                    @*@(Html.Kendo().Grid<QuestionIndexDto>()
                        .Name("grid")
                        //.TableHtmlAttributes(new { style = "table-layout: auto;" })
                        .ToolBar(t => t.Search())
                        .Pageable()
                        .Scrollable(s => s.Enabled(true))
                        .Filterable(f => f.Mode(GridFilterMode.Row))
                        .Resizable(resize => resize.Columns(true)) // Allow column resizing
                        .Width("2000px") // Fix width
                        .Height(540)
                        //.HtmlAttributes(new { style = "width:100%; overflow-x:auto;" }) // Optional: add container style
                        .Columns(columns =>
                        {
                            columns.Bound(m => m.SerialNo)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Sr. No.")
                                .Width("5%");
                            columns.Bound(m => m.Description)
                                .Encoded(false);
                            columns.Bound(m => m.QuestionTypeName)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Question Type")
                                .Width("10%");
                            columns.Bound(m => m.Marks)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Width("5%");
                            columns.Bound(m => m.ChapterName)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Chapter")
                                .Width("15%");
                            columns.Bound(m => m.DifficultyLevel)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Diff. Level")
                                .Width("5%");
                            columns.Bound(m => m.PaperCategoryName)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Paper Category")
                                .Width("15%");
                            columns.Bound(m => m.OcNo)
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("OC. No.")
                                .Width("5%");

                            columns.Bound(m => m.Status)
                                .ClientTemplate(
                                    "<span class='badge' style='background-color: " +
                                    "# if (Status == \"Active\") { #" +
                                    "green" +
                                    "# } else if (Status == \"Accepted\") { #" +
                                    "blue" +
                                    "# } else if (Status == \"Rejected\") { #" +
                                    "red" +
                                    "# } else { #" +
                                    "transparent" +
                                    "# } #" +
                                    "; color: " +
                                    "# if (Status == \"Active\" || Status == \"Accepted\" || Status == \"Rejected\") { #" +
                                    "white" +
                                    "# } else { #" +
                                    "black" +
                                    "# } #" +
                                    "; text-align: center; display: inline-block; width: 100%;'>" +
                                    "#= Status #</span>"
                                )
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Width("5%");
                            columns.Command(command =>
                            {
                                command.Custom("Edit").Text("Edit").IconClass("k-icon k-i-pencil")
                                    .HtmlAttributes(new { @class = "k-grid-edit" })
                                    .Visible("function(dataItem) { return dataItem.Status === 'Active'; }"); // Show only if Status is "Active";
                            })
                                .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                .Title("Actions")
                                .Width("5%"); // Add a class to identify the command column;

                        })
                        .Events(events => events.DataBound("onDataBound"))
                        .DataSource(dataSource => dataSource
                            .Ajax()
                            .Read(read => read.Action("GetIndexPapers", "Question"))
                        ))*@
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function onCreate() {
        window.location.href = '/Question/Create';
    }

    @*function onDataBound(e) {
        $1$var grid = $("#grid").data("kendoGrid");
        // Auto-fit each column
        grid.columns.forEach(function (column, index) {
            grid.autoFitColumn(index);
        });#1#

        // Show Serial No
        var grid = $("#grid").data("kendoGrid");
        var dataItems = grid.dataSource.view();
        // Reset serial number for each page
        var startingNumber = (grid.dataSource.page() - 1) * grid.dataSource.pageSize();
        console.log("Details : " + startingNumber + ", " + dataItems.length)
        for (var i = 0; i < dataItems.length; i++) {
            console.log("No : " + startingNumber + i + 1)
            // Assign serial number property
            //dataItems[i].SerialNo = startingNumber + i + 1;
            dataItems[i].set("SerialNo", startingNumber + i + 1);
        }

        $(".k-grid-edit").on("click", function () {
            var grid = $("#grid").data("kendoGrid");
            var row = $(this).closest("tr");
            var dataItem = grid.dataItem(row);

            if (dataItem) {
                var id = dataItem.Id; // Assuming Id is the unique identifier of the item
                window.location.href = '/Question/Edit/' + id; // Replace with your edit page URL
            }
        });
    }*@

    function onEditClick(e) {
        e.preventDefault();
        var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        window.location.href = '@Url.Action("Create", "Question")' +
            '?FacultyId=' + dataItem.FacultyId +
            '&CourseId=' + dataItem.CourseId +
            '&CoursePartId=' + dataItem.CoursePartId +
            '&SubjectId=' + dataItem.SubjectId + 
            '&PaperCategoryId=' + dataItem.PaperCategoryId;
        //window.location.href = '@Url.Action("Edit", "Question")' + '/' + dataItem.Id;
    }

    function sendData() {
    }

</script>