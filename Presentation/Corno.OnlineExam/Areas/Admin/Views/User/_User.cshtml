@using System.ComponentModel
@using Corno.Data.Helpers
@using Corno.Globals.Constants
@using Kendo.Mvc.UI
@model Corno.Data.ViewModels.Admin.UserCrudViewModel

@{
    var formEnabled = ViewData[ModelConstants.FormEnabled].ToBoolean();
    var action = ViewBag.Action as string;
}

@Html.ValidationSummary(false)
@using (Html.BeginForm(action, "User", FormMethod.Post, new { id = "form", enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(false)
    @Html.AntiForgeryToken()

    @Html.HiddenFor(m => m.Id)
    <div class="k-card">
        <div class="k-card-header">
            <div class="col-sm-10">
                <h3>@ViewBag.Title</h3>
            </div>
            <div class="col-sm-2 text-right">
                @(Html.Kendo().Button()
                    .Name("back_to_list")
                    .Icon("arrow-left")
                    .SpriteCssClass("k-icon-64")
                    .FillMode(ButtonFillMode.Outline)
                    .ThemeColor(ThemeColor.Info)
                    .Content("Back To list")
                    .Events(e => e.Click("onBackToList"))
                    .HtmlAttributes(new { @class = "w-100" }))
            </div>
        </div>
        <div class="k-card-separator"></div>
        <div class="k-card-body">
            <div class="row">
                <div class="form-group">
                    <div class="col-sm-6">
                        @(Html.Kendo().TextBoxFor(m => m.FirstName)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("First Name")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                @class = "required w-100"
                            }))
                    </div>
                    <div class="col-sm-6">
                        @(Html.Kendo().TextBoxFor(m => m.LastName)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("Last Name")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                @class = "required w-100"
                            }))
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-6">
                        @(Html.Kendo().TextBoxFor(m => m.Email)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("Email")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                @class = "required w-100"
                            }))
                    </div>
                    <div class="col-sm-6">
                        @(Html.Kendo().TextBoxFor(m => m.PhoneNumber)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("Phone No.")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                @class = "required w-100"
                            }))
                    </div>
                </div>
            </div>

            <div class="k-card-separator"></div>
            <hr />
            <div class="row">
                @if (action != ModelConstants.Edit)
                {
                    <div class="form-group">
                        <div class="col-sm-12">
                            @(Html.Kendo().TextBoxFor(m => m.UserName)
                            .Enable(action == ModelConstants.Create)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("User Name")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                @class = "required w-100"
                            }))
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-6">
                            @(Html.Kendo().TextBoxFor(m => m.Password)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("Password")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                type = "password",
                                @class = "required w-100"
                            }))
                        </div>
                        <div class=" col-sm-6">
                            @(Html.Kendo().TextBoxFor(m => m.ConfirmPassword)
                            .Enable(formEnabled)
                            .Rounded(Rounded.Medium)
                            .Label(label => label
                                .Content("Confirm Password")
                                .Floating(true))
                            .HtmlAttributes(new
                            {
                                type = "password",
                                @class = "required w-100"
                            }))
                        </div>
                    </div>
                }
            </div>

            <div class="row">
                <div class="col-sm-12">
                    @(Html.Kendo().Grid(Model.Roles)
                             .Name("grid")
                             .ToolBar(t =>
                             {
                                 /*t.Custom()
                                     .HtmlAttributes(new { style = "float: left; margin-right: 0px;" })
                                     .Text("<strong>Roles</strong>");*/
                                 t.Search();
                                 t.Excel();
                             })
                             .Columns(columns =>
                             {
                                 columns.Bound(p => p.RoleName)
                                     .ClientTemplate("#= RoleName #" + "<input type='hidden' name='Roles[#= index(data)#].RoleName' value='#= RoleName #'   />")
                                     .HtmlAttributes(new { @class = "k-text-left !k-justify-content-left" })
                                     .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                     .Title("Name")
                                     .Width(200);
                                 columns.Template(@<text></text>)
                                     .ClientTemplate("<input type='checkbox' #= IsSelected ? checked='checked':'' # class='chkIsSelected' name='Roles[#= index(data)#].IsSelected' value='#= IsSelected #' />")
                                     .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                                     .HtmlAttributes(new { @class = "k-text-center !k-justify-content-center text-align-middle" })
                                     .Title("")
                                     .Width(50);
                             })
                             //.Editable(editable => editable.Mode(GridEditMode.InCell))
                             .Scrollable(s => s.Enabled(true).Height("auto").Virtual(true))
                             .Sortable()
                             .Pageable()
                             .PersistSelection()
                             .Height(500)
                             .DataSource(dataSource => dataSource
                                 .Ajax()
                                 .Model(model =>
                                 {
                                     model.Id(p => p.RoleName);
                                 })
                                 .Aggregates(aggregates =>
                                 {
                                 })
                                 .ServerOperation(false)
                                 .Create(update => update.Action("Inline_Create_Update_Destroy", "User"))
                                 .Update(update => update.Action("Inline_Create_Update_Destroy", "User"))
                                 .Destroy(update => update.Action("Inline_Create_Update_Destroy", "User"))
                             )
                             .Resizable(resize => resize.Columns(true))
                             .Reorderable(reorder => reorder.Columns(true)))

                </div>
            </div>
        </div>
        <div class="k-card-footer">
            <div class="col-sm-offset-11 col-sm-1 text-right">
                @(Html.Kendo().Button()
                        .Name("save")
                        .Icon("save")
                        .SpriteCssClass("k-icon-64")
                        .FillMode(ButtonFillMode.Outline)
                        .ThemeColor(ThemeColor.Success)
                        .Content("Save")
                        .HtmlAttributes(new
                        {
                            type = "submit",
                            //name = "action:Create",
                        }))
            </div>
        </div>
    </div>
}

<script>

    $(function () {
        $('#grid').on('click', '.chkIsSelected',
            function () {
                var checked = $(this).is(':checked');
                var grid = $('#grid').data().kendoGrid;
                var dataItem = grid.dataItem($(this).closest('tr'));
                dataItem.set('IsSelected', checked);
            });
    });

    function onBackToList() {
        window.location.href = '/Masters/User/Index';
    }


</script>