@model Corno.Data.Corno.AnswerSheet
@{
    ViewBag.Title = "Create New Answer Sheet Form";
}

<div class="row">
    <div id="breadcrumb" class="col-md-12">
        <ol class="breadcrumb">
            <li><a href="#">Online Exam</a></li>
            <li><a href="#">AnswerSheet Form</a></li>
        </ol>
    </div>
</div>
@if (ViewData["Error"] != null)
{
    <div class="red">
        <p>Error: @ViewData["Error"].ToString()</p>
    </div>
    <script type="text/javascript">
        bootbox.alert("@TempData["Error"]")
    </script>
}
@if (TempData["Success"] != null)
{
    <div class="green">
        <p>Success: @TempData["Success"].ToString()</p>
    </div>
    <script type="text/javascript">
        bootbox.alert("@TempData["Success"]")
    </script>
}
@Html.ValidationSummary(true)
<div class="row">
    <div class="col-xs-12 col-sm-12">
        <div class="box ui-draggable ui-droppable">
            <div class="box-header">
                <div class="box-name">
                    <i class="fa fa-plus-square large"></i>
                    <span>Create a new Answer Sheet Form.</span>
                </div>
            </div>
            <div class="box-content">
                @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "form", enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    <div class="form-horizontal">
                        <div class="box-content">
                            <div class="form-group">
                                <div class="col-sm-2 text-center">
                                    <button type="button" value="Index" class="btn btn-primary btn-label-left" onclick="location.href='@Url.Action("Details", new { area = "Reports", controller = "Report", reportName = "AnswerSheetChallanRpt", description = "AnswerSheet form Challan" })' ">
                                        <span><i class="fa fa-file-excel-o"></i></span>
                                        Challan
                                    </button>
                                </div>
                                <div class="col-sm-2 text-center">
                                    <button type="button" value="Index" class="btn btn-primary btn-label-left" onclick="location.href='@Url.Action("Details", new { area = "Reports", controller = "Report", reportName = "AnswerSheetRpt", description = "Detail Report" })' ">
                                        <span><i class="fa fa-file-excel-o"></i></span>
                                        Detail Report
                                    </button>
                                </div>
                                <div class="col-sm-offset-6 col-sm-2">
                                    <button type="submit" value="Create" title="Save" class="btn btn-primary btn-label-left pull-right">
                                        <span><i class="fa fa-save"></i></span>
                                        Submit
                                    </button>
                                </div>
                            </div>
                            <div class="panel panel-info">
                                <div class="panel-heading"><strong>Student Details</strong></div>
                                <div class="panel-body">
                                    <div class="form-group  has-feedback">
                                        <label class="col-sm-2 control-label">Seat No :</label>
                                        <div class="col-sm-3">
                                            @Html.TextBoxFor(m => m.SeatNo, new { id = "SeatNo", @class = "form-control", value = "@Model.SeatNo", placeholder = "Please Enter Seat No", data_toggle = "tooltip", data_placement = "bottom", title = "Seat No" })
                                        </div>
                                        <div class="col-sm-1">
                                            <button type="submit" name="submitType" value="Search" class="btn btn-warning">
                                                <span><i class="fa fa-search"></i></span>
                                            </button>
                                            <button type="submit" id="ReceiveChallan" name="submitType" value="ReceiveChallan" class="btn btn-warning invisible"></button>
                                        </div>
                                    </div>
                                    <div class="form-group  has-feedback">
                                        <div class="col-sm-8">
                                            <table class="table table-bordered">
                                                <tr>
                                                    <th class="text-left col-sm-2">
                                                        <strong>Name :</strong>
                                                    </th>
                                                    <td class="text-left col-sm-6">
                                                        @Html.HiddenFor(m => m.StudentName, new { Value = Model.StudentName })
                                                        @Html.DisplayFor(m => m.StudentName)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left col-sm-2"><strong>Centre :</strong></th>
                                                    <td id="tdCentre" class="text-left">
                                                        @if (Model.CentreId > 0)
                                                        {@Html.Display("(" + Model.CentreId + ")")}
                                                        @Html.HiddenFor(m => m.CentreId, new { Value = Model.CentreId })
                                                        @Html.HiddenFor(m => m.CentreName, new { Value = Model.CentreName })
                                                        @Html.DisplayFor(m => m.CentreName)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left col-sm-2"><strong>College :</strong></th>
                                                    <td class="text-left">
                                                        (@Model.CollegeId)
                                                        @Html.HiddenFor(m => m.CollegeId, new { Value = Model.CollegeId })
                                                        @Html.HiddenFor(m => m.CollegeName, new { Value = Model.CollegeName })
                                                        @Html.DisplayFor(m => m.CollegeName)
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left col-sm-2"><strong>Course :</strong></th>
                                                    <td id="tdCourse" class="text-left">
                                                        (@Model.CourseId) @Html.DisplayFor(m => m.CourseName)
                                                        @Html.HiddenFor(m => m.CourseId, new { Value = Model.CourseId })
                                                        @Html.HiddenFor(m => m.CourseName, new { Value = Model.CourseName })
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left col-sm-2"><strong>Course Part :</strong></th>
                                                    <td class="text-left">
                                                        (@Model.CoursePartId) @Html.DisplayFor(m => m.CoursePartName)
                                                        @Html.HiddenFor(m => m.CoursePartId, new { Value = Model.CoursePartId })
                                                        @Html.HiddenFor(m => m.CoursePartName, new { Value = Model.CoursePartName })
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th class="text-left col-sm-2"><strong>Branch :</strong></th>
                                                    <td id="tdBranch" class="text-left">
                                                        @if (Model.BranchId > 0)
                                                        {
                                                            @Html.HiddenFor(m => m.BranchId, new { Value = Model.BranchId })
                                                            @Html.Display("(" + Model.BranchId + ")")
                                                        }
                                                        @Html.HiddenFor(m => m.BranchName, new { Value = Model.BranchName })
                                                        @Html.DisplayFor(m => m.BranchName)
                                                    </td>
                                                </tr>
                                            </table>
                                            <div>
                                                <label class="col-sm-3 control-label"><strong> Mobile No :<code>*</code></strong></label>
                                                <div class="col-sm-8">
                                                    @Html.TextBoxFor(m => m.MobileNo, new { id = "MobileNo", @class = "form-control", value = "@Model.MobileNo", placeholder = "Please Enter Mobile No", data_toggle = "tooltip", data_placement = "bottom", title = "Mobile No", onkeypress = "return isNumber(event)" })
                                                </div>
                                            </div>
                                            <div>
                                                <label class="col-sm-3 control-label"><strong>Email Id :<code> *</code></strong></label>
                                                <div class="col-sm-8">
                                                    @Html.TextBoxFor(m => m.EmailId, new { id = "EmailId", @class = "form-control", value = "@Model.EmailId", placeholder = "Please Enter Email Id", data_toggle = "tooltip", data_placement = "bottom", title = "Email ID" })
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="col-sm-2"><strong>Photo:</strong></div>
                                            <div class="col-sm-2"><img src="@Model.Photo" width="150" height="200" /></div>
                                            @Html.HiddenFor(m => m.Photo, new { Value = Model.Photo })
                                        </div>
                                    </div>
                                    <div class="form-group  has-feedback">
                                        <table class="table table-bordered table-striped table-responsive table-hover table-heading" id="datatable-1">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Select</th>
                                                    <th class="text-center">Category</th>
                                                    <th class="text-center">Course Part </th>
                                                    <th class="text-center">Subject</th>
                                                    <th class="text-center">Fee</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @{
                                                    var index = 0;
                                                }
                                                @foreach (var item in Model.AnswerSheetSubjects)
                                                {
                                                    <tr>
                                                        <td align="center">
                                                            @Html.CheckBox("AnswerSheetSubjects[" + index + "].IsSelected", item.IsSelected, new { @class = "checkbox" })
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].IsSelected", item.IsSelected)
                                                        </td>
                                                        <td class="text-center">
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].CategoryCode", item.CategoryCode)
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].CategoryName", item.CategoryName)
                                                            @Html.DisplayFor(i => item.CategoryName)
                                                            (@Html.DisplayFor(i => item.CategoryCode))
                                                        </td>
                                                        <td class="text-center">
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].CoursePartId", item.CoursePartId)
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].CoursePartName", item.CoursePartName)
                                                            @Html.DisplayFor(i => item.CoursePartName)
                                                            (@Html.DisplayFor(i => item.CoursePartId))
                                                        </td>
                                                        <td>
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].SubjectId", item.SubjectId)
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].SubjectName", item.SubjectName)
                                                            @Html.DisplayFor(i => item.SubjectName)
                                                            (@Html.DisplayFor(i => item.SubjectId))
                                                        </td>
                                                        <td class="text-right">
                                                            @Html.Hidden("AnswerSheetSubjects[" + index + "].Fee", item.Fee)
                                                            @Html.DisplayFor(i => item.Fee)
                                                        </td>
                                                    </tr>
                                                    index++;
                                                }
                                            </tbody>
                                            <tfoot>
                                                <tr>
                                                    <th class="text-right" colspan="4">
                                                        Total
                                                    </th>
                                                    <td class="text-right">
                                                        @Html.DisplayFor(i => i.TotalFee)
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-8 col-sm-2">
                                <button type="submit" name="submitType" value="FeeCalculation" class="btn btn-warning">
                                    <span><i class="fa fa-search"></i></span> Calculate Fee
                                </button>
                            </div>
                            <div class="col-sm-2">
                                <button type="submit" value="Create" title="Save" class="btn btn-primary btn-label-left pull-right">
                                    <span><i class="fa fa-save"></i></span>
                                    Submit
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }

    function onEditStudent() {
        bootbox.prompt('Enter SeatNo!',
            function (seatNo) {
                var url = '@Url.Action("Edit", "AnswerSheet", new { seatNo = "__seatNo__" })';
                window.location.href = url.replace('__seatNo__', seatNo);
            });
    }

    function handleClick() {
        $('#form').append('<input type="text" name="submitType" value="FeeCalculation" />');
        $("form").submit();
    }

    function filterCourses() {
        return {
            CollegeID: $("#CollegeID").val(),
            CourseTypeID: $("#CourseTypeID").val()
            //courseFilter: $("#CourseID").data("kendoComboBox").input.val()
        };
    }

    function ClearForm() {
        $('#Activity').val('');
        $('input:checkbox').removeAttr('checked');
        $('#ApprovalDate').val('');
        $('#Remark').val('');

        $("#CoursePartID").data("kendoComboBox").value(null);
        $("#ExamSubjectViewModels").data("kendoGrid").dataSource.data([]);
    }

    $('#SeatNo').change(function () {
        $('#form').append('<input type="text" name="submitType" value="Search" />');
        $("form").submit();
    });

    $(document).ready(function () {
        // Add tooltip to form-controls
        $('.form-control').tooltip();

        LoadBootstrapValidatorScript(DemoFormValidator);
    });
</script>
