@using Kendo.Mvc.UI
@model Corno.Data.Corno.Masters.Subject

<div class="row">
    @(Html.Kendo().Grid(Model.SubjectChapterDetails)
        .Name("gridChapter")
        .Columns(columns =>
        {
            columns.Bound(s => s.Id)
                .ClientTemplate("<input type='hidden' name='SubjectChapterDetails[#= index(data, 'gridChapter')#].Id' value='#= Id #'   />")
                .Hidden();
            columns.Bound(s => s.SerialNo)
                .ClientTemplate("#= SerialNo #" + "<input type='hidden' name='SubjectChapterDetails[#= index(data, 'gridChapter')#].SerialNo' value='#= SerialNo #'   />")
                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                .HtmlAttributes(new { @class = "k-text-left !k-justify-content-left text-align-middle" })
                .Width(30);
            columns.Bound(p => p.Name)
                .ClientTemplate("#= Name #" + "<input type='hidden' name='SubjectChapterDetails[#= index(data, 'gridChapter')#].Name' value='#= Name #'   />")
                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                .HtmlAttributes(new { @class = "k-text-left !k-justify-content-left text-align-middle" })
                .Title("Name")
                .Width(200);
            columns.Bound(p => p.Description)
                .ClientTemplate("#= Description #" + "<input type='hidden' name='SubjectChapterDetails[#= index(data, 'gridChapter')#].Description' value='#= Description #'   />")
                .HeaderHtmlAttributes(new { @class = "k-text-center !k-justify-content-center" })
                .HtmlAttributes(new { @class = "k-text-left !k-justify-content-left text-align-middle" })
                .Title("Description")
                .Width(200);
            columns.Command(command =>
            {
                command.Edit();
                command.Destroy();
            }).Width(100);
        })
        .ToolBar(toolbar => toolbar.Create())
        /*.ToolBar(toolbar =>
        {
            toolbar.Template("<a id='addNewRecordButton' class='k-button k-button-icontext k-grid-add' href='#'><span class='k-icon k-i-plus'></span>Add new record</a>");
        })*/
        .Editable(editable => editable.Mode(GridEditMode.InLine))
        /*.Editable(editable => editable.Mode(GridEditMode.PopUp)
            .TemplateName("/Subject/_CategoryDetailPopup"))*/
        //.Sortable(s => s.AllowUnsort(true))
        //.Pageable()
        .Scrollable()
        .DataSource(dataSource => dataSource
            .Ajax()
            //.PageSize(20)
            .Events(events => events.Error("error_handler"))
            .Model(model =>
            {
                model.Id(p => p.Id);
                model.Field(p => p.Name);
                model.Field(p => p.Description);
                //model.Field(p => p.CreatedDate).DefaultValue(DateTime.Now);
            })
            .ServerOperation(false)
            .Create(update => update.Action("Grid_Chapter_Operations", "Subject"))
            .Update(update => update.Action("Grid_Chapter_Operations", "Subject"))
            .Destroy(update => update.Action("Grid_Chapter_Operations", "Subject"))
        )
        .Resizable(resize => resize.Columns(true))
        .Reorderable(reorder => reorder.Columns(true)))
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var grid = $("#gridChapter").data("kendoGrid");

        grid.dataSource.bind("save", function (e) {
            if (e.model.isNew()) {
                console.log("in add");
                var dataSource = grid.dataSource;
                e.model.set("SerialNo", dataSource.data().length + 1); // Set SerialNo to length + 1
            }
        });
    });

</script>