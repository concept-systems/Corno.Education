@model Corno.Data.Corno.Question_Bank.Models.QuestionBankModel
@using Corno.Globals.Constants
@using Kendo.Mvc.UI

<div class="form-group">
    @Html.LabelFor(m => m.FacultyId, "Faculty",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.FacultyId)
            .DataTextField(ModelConstants.NameWithId)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class="w-100"})
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource => dataSource
                .Read(read => read.Action("GetFaculties", "Corno"))
            ))
    </div>
</div>

<div class="form-group">
    @Html.LabelFor(m => m.CourseId, "Course :",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.CourseId)
            .DataTextField(ModelConstants.NameWithId)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class = "w-100" })
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource =>
            {
                dataSource.Read(read => {read.Action("GetCoursesByFaculty", "Corno").Data("filterCourses");})
                    .ServerFiltering(true);
            })
            .Enable(false)
            .AutoBind(false)
            .CascadeFrom(ModelConstants.FacultyId))
        <script>
            function filterCourses() {
                //alert($("#CourseId").data("kendoMultiColumnComboBox").input.val());
                return {
                    facultyId: $("#FacultyId").val(),
                    Filter: $("#CourseId").data("kendoMultiColumnComboBox").input.val()
                };
            }
        </script>
    </div>
</div>
<div class="form-group">
    @Html.LabelFor(m => m.CoursePartId, "Course Part :",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.CoursePartId)
            .DataTextField(ModelConstants.NameWithCode)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class = "w-100" })
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource =>
            {
                dataSource.Read(read =>
                {
                    read.Action("GetCoursePartsByCourse", "Corno").Data("filterCourseParts");
                })
                    .ServerFiltering(true);
            })
            .Enable(false)
            .AutoBind(false)
            .CascadeFrom(ModelConstants.CourseId))
        <script>
            function filterCourseParts() {
                return {
                    courseId: $("#CourseId").val(),
                    Filter: $("#CoursePartId").data("kendoMultiColumnComboBox").input.val()
                };
            }
        </script>
    </div>
</div>
<div class="form-group">
    @Html.LabelFor(m => m.BranchId, "Branch :",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.BranchId)
            .DataTextField(ModelConstants.NameWithId)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class = "w-100" })
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource =>
            {
                dataSource.Read(read =>
                {
                    read.Action("GetBranchesByCoursePart", "Corno").Data("filterBranches");
                })
                    .ServerFiltering(true);
            })
            .Enable(false)
            .AutoBind(false)
            .CascadeFrom(ModelConstants.CoursePartId))
        <script>
            function filterBranches() {
                return {
                    courseId: $("#CourseId").val(),
                    coursePartId: $("#CoursePartId").val(),
                    Filter: $("#BranchId").data("kendoMultiColumnComboBox").input.val()
                };
            }
        </script>
    </div>
</div>
<div class="form-group">
    @Html.LabelFor(m => m.SubjectId, "Subject :",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.SubjectId)
            .DataTextField(ModelConstants.NameWithCode)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class = "w-100" })
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Events(e => e.Change("onChange"))
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource =>
            {
                dataSource.Read(read =>
                {
                    read.Action("GetSubjectsByCoursePart", "Corno").Data("filterSubjects");
                })
                    .Events(e => e.Change("onBoundChange"))
                    .ServerFiltering(true);
            })
            .Enable(false)
            .AutoBind(false)
            .CascadeFrom(ModelConstants.CoursePartId))
        <script>
            function filterSubjects() {
                return {
                    coursePartId: $("#CoursePartId").val(),
                    branchId: $("#BranchId").val(),
                    onlyTheory: true,
                    Filter: $("#SubjectId").data("kendoMultiColumnComboBox").input.val()
                };
            }
        </script>
    </div>
</div>
<div class="form-group">
    @Html.LabelFor(m => m.PaperCategoryId, "Paper Category",
        new { @class = "col-sm-2 control-label" })
    <div class="col-sm-10">
        @(Html.Kendo().MultiColumnComboBoxFor(m => m.PaperCategoryId)
            .DataTextField(ModelConstants.Name)
            .DataValueField(ModelConstants.Id)
            .HtmlAttributes(new { @class="w-100"})
            .Filter(FilterType.Contains)
            .Placeholder("Select ...")
            .Columns(columns =>
            {
                columns.Add().Field(ModelConstants.Id).Width("100px");
                columns.Add().Field(ModelConstants.Code).Width("100px");
                columns.Add().Field(ModelConstants.Name).Width("600px");
            })
            .DataSource(dataSource => dataSource
                .Read(read => read.Action("GetMiscMasters", "Corno", new {miscType = "PaperCategory"}))
                .ServerFiltering(true)
            )
            .Enable(false)
            .AutoBind(false)
            .CascadeFrom(ModelConstants.SubjectId))
    </div>
</div>